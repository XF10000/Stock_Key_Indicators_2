# 风险评估报告

## 1. 技术风险

### 1.1 API 接口变更

-   **风险等级**: 高
-   **影响范围**: `data_updater.py` 的核心数据获取功能可能完全失效。
-   **发生概率**: 中
-   **应对措施**:
    -   将 API 的 URL、参数和关键字段名存储在外部配置文件中。
    -   将所有 `akshare` 调用严格封装在 `AkshareClient` 适配器类中。
    -   在获取数据后立即进行结构校验，失败则记录错误并跳过。
-   **监控指标**: API 调用的成功率和失败率。失败率的突然飙升是接口变更的强预警信号。
-   **降级策略**: 校验失败的数据不会被写入数据库，`data_updater.py` 会跳过失败的股票并继续处理其余列表。

### 1.2 依赖库兼容性问题

-   **风险等级**: 中
-   **影响范围**: 项目在更新环境或依赖后可能无法正常运行。
-   **发生概率**: 低
-   **应对措施**:
    -   在 `requirements.txt` 文件中明确指定所有依赖库的精确版本号。
-   **监控指标**: 使用 GitHub Dependabot 等工具自动扫描依赖库更新。
-   **降级策略**: 版本锁定机制可防止因环境自动更新而导致程序崩溃。

## 2. 性能风险

### 2.1 全量数据更新耗时

-   **风险等级**: 高
-   **影响范围**: 首次初始化数据库的过程将非常漫长（可能长达数小时），且容易因网络波动而中断。
-   **发生概率**: 高
-   **应对措施**:
    -   在 `data_updater.py` 中实现断点续传机制。
    -   在更新过程中向控制台实时打印清晰的进度信息。
-   **监控指标**: 记录整个更新过程的总耗时和平均每只股票的处理耗时。
-   **降级策略**: 用户可以随时安全地中断更新过程，已下载的数据不会丢失，下次运行时可自动续传。

### 2.2 全市场分析性能

-   **风险等级**: 低 (因已加入缓存策略)
-   **影响范围**: 首次计算某个指标的中位数时，程序响应可能较慢。
-   **发生概率**: 中
-   **应对措施**:
    -   **中位数结果缓存**: 对计算出的全市场中位数结果进行数据库缓存，后续分析可直接复用，极大提升响应速度。
    -   **数据库索引**: 在数据库的核心查询字段上建立索引。
    -   **查询优化**: 编写查询时只选择必需的列。
-   **监控指标**: 记录核心分析函数的执行时间，区分缓存命中和未命中的情况。
-   **降级策略**: 缓存失效机制（数据更新时清空缓存）确保了数据的一致性。

## 3. 数据质量风险

### 3.1 财务科目不一致

-   **风险等级**: 高
-   **影响范围**: 指标计算逻辑因找不到指定的列名而出错，导致结果不准确或程序失败。
-   **发生概率**: 高
-   **应对措施**:
    -   创建一个科目名映射配置文件，在数据入库前将不同的科目名标准化为统一的内部名称。
-   **监控指标**: 记录所有在映射文件中未找到的原始科目名，以便后续补充。
-   **降级策略**: 如果关键计算所需的科目在标准化后依然缺失，该计算返回 `NaN` 并记录警告日志。

### 3.2 股票列表变动

-   **风险等级**: 低
-   **影响范围**: 数据库无法包含新上市公司的数据。
-   **发生概率**: 高
-   **应对措施**:
    -   `data_updater.py` 每次运行时，都通过 API 重新获取最新的全市场股票列表。
-   **监控指标**: 记录每次更新时股票列表的总数变化。
-   **降级策略**: 无。

## 4. 风险汇总

### 4.1 高风险列表

-   API 接口变更
-   全量数据更新耗时
-   财务科目不一致

### 4.2 中风险列表

-   依赖库兼容性问题
-   全市场分析性能

### 4.3 低风险列表

-   股票列表变动

## 5. 优先关注事项

1.  **`data_updater.py` 的健壮性**: 必须优先实现断点续传和清晰的进度反馈。
2.  **数据标准化流程**: 必须建立科目名映射机制，这是保证计算准确性的核心。
3.  **数据库索引**: 在创建数据库表时必须同步建立索引。

## 6. 待确认事项

-   无
