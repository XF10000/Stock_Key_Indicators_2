# 需求澄清报告

## 1. 需求理解
本项目旨在开发一个股票关键指标分析工具。该工具将针对用户指定的A股上市公司，计算并分析四大核心财务指标，同时与全A股市场的公司进行横向和纵向的对比。最终的分析结果将以图表和Excel文件的形式呈现。

**核心分析指标**:

### 指标1：报表逻辑一致性检验暨回款周期
- **子指标1：应收账款周转率对数** = ln(TTM营业收入 / 平均应收账款)
  - TTM营业收入：最近四个季度的单季度营业收入之和
  - 平均应收账款 = (期初应收账款 + 期末应收账款) / 2
  - **注**：报告中显示的是对数值，便于不同规模企业的对比
- **子指标2：毛利率** = (营业收入 - 营业成本) / 营业收入
- **分析目的**：通过应收账款周转率和毛利率的联合分析，检验报表逻辑一致性和回款能力

**深度分析说明**：
1. **10年数据透视**：应收账款周转率在全A样本中呈对数正态分布，真实性具备保障
2. **虚增收入检验逻辑**：应收账款周转率=营业收入/应收账款，通常大于1，因此如果通过虚增应收账款来虚增营业收入，分子分母同时增加相同的值，应收账款周转率大概率下降。应收账款周转率下降意味着企业在产业链上的竞争力减弱
3. **毛利率交叉验证**：但是营业成本很难随营业收入等比例虚增（折旧源于历史成本，员工工资需要和社保数据对应），如果通过虚增应收账款来虚增营业收入，毛利率可能上升，这又意味着企业议价权提高，与应收账款周转率指向不一致
4. **一致性检验**：因此，检验应收账款周转率和毛利率走势一致性，是重要的报表质量验证方法，不一致不一定有问题，但是需要给出合理解释

### 指标2：再投资质量暨跑冒滴漏风险检验
- **指标：长期经营资产周转率对数** = ln(TTM营业收入 / 平均长期经营资产)
  - 平均长期经营资产 = (期初长期经营资产 + 期末长期经营资产) / 2
  - **长期经营资产** = 固定资产 + 在建工程 + 生产性生物资产 + 公益性生物资产 + 油气资产 + 使用权资产 + 无形资产 + 开发支出 + 商誉 + 长期待摊费用 + 其他非流动资产
  - **注**：报告中显示的是对数值
- **分析目的**：评估公司长期资产的使用效率和再投资质量，识别跑冒滴漏风险

**深度分析说明**：
1. **10年数据透视**：营业收入/(固定资产+无形资产)在全A样本中呈对数正态分布
2. **影响因素**：影响固定资产周转率的因素包括单位产能造价、产能利用率、产品单价，一方面反映再投资质量，同时可以反映跑冒滴漏程度
3. **三步循环法检验**：如果上市公司采用了完整的"三步循环法"一般会将虚增的利润(或者跑冒滴漏)变成了固定资产、无形资产等长期资产，再通过未来折旧或者减值消化，由于资产负债表是累积式的，周转率指标会发生趋势性下降
4. **分析要点**：无论是哪种情况，固定资产+无形资产周转率下降，尤其是单个公司在全A样本中的分位数下降，都代表存量资产以及再投资质量下降，是重大的负面指标；反之则意味着资产利用效率、产业竞争力实打实改善

### 指标3：产业链地位检验暨资金运用能力
- **指标：营运净资本比率** = 营运净资本 / 总资产 × 100%
  - **营运净资本** = 应收账款 + 应收票据 + 应收款项融资 + 合同资产 - 应付账款 - 应付票据 - 合同负债
  - **总资产**：财务报表中的"资产总计"
  - **解读**：负值表示公司占用上下游资金（产业链地位强），正值表示被上下游占用资金（产业链地位弱）
- **分析目的**：评估公司在产业链中的地位和议价能力

**深度分析说明**：
1. **10年数据透视**：营运净资本占总资产的比例在全A样本呈正态分布，真实性具备保障
2. **双重含义**：营运净资本(应收账款+应收票据+应收款项融资+合同资产-应付账款-应付票据-合同负债)占比一方面体现上市公司资金运用效率，即不能创造收益的在途资金占比，另一方面反映公司在上下游产业链中的地位
3. **分布特征**：该指标是所有指标中，全A样本分布"最正态"的一个，且全A样本中位数非常接近零
4. **龙头验证**：尤其注意单个公司的该指标在全A样本中的分位数的边际变化。如果该公司在估值中的叙事是"龙头优势明显、强者恒强"，营运净资本占比在全A样本中的分位数就应该持续下降，或者绝对分位数很低，否则就是重大不一致，需要找到充足的理由解释

### 指标4：真实盈利水平暨现金流创造能力
- **指标：经营现金流比率** = 经营活动产生的现金流量净额 / 总资产 × 100%
  - **经营活动产生的现金流量净额**：财务报表中的"经营活动产生的现金流量净额"
  - **总资产**：财务报表中的"资产总计"
- **分析目的**：评估公司真实的盈利能力和现金创造能力，数值越高说明盈利质量越好

**深度分析说明**：
1. **10年数据透视**：经营性现金流量净额/总资产在全A样本呈正态分布，真实性具备保障
2. **等价ROA**：经营性现金流量净额中包含财务费用，因此分母用总资产，该指标相当于ROA。如之前所述，全A样本ROE存在调节的可能性，该指标更能体现资产的现金流创造能力
3. **市场基准**：2024年全A样本该指标的中位数只有4.3%，反映了A股市场加杠杆之前的"平均盈利水平"；而2025Q1分布则呈现明显的左侧厚尾(历年一季度都有这个特点)，中位数接近零，即大部分公司一季度回款一般，如果单个公司一季度回款较好，则尤为不易
4. **叙事一致性**：该指标的绝对值高低本身无谓多空，而是要对比财报中的画像与估值中隐含的叙事的一致性，包括历史趋势与全A样本分位数走势

**通用计算规则**:
-   **TTM营业收入**: 最近四个季度的单季度营业收入之和（年化处理）
-   **平均资产**: (期初资产 + 期末资产) / 2
-   **累计值处理**: 利润表和现金流量表通常为年初至今的累计值，需计算单季度值（当季累计 - 上季累计）；资产负债表为时点值，无需转换
-   **对数转换**: 应收账款周转率和长期资产周转率取自然对数，便于不同规模企业的横向对比

**核心分析维度**:
- 目标公司指标的10年历史走势
- 目标公司指标在全A股样本中的分位数历史走势
- 全A股样本该指标的中位数历史走势
- 全A股样本该指标的当前分布情况

## 2. 需求确认
### 2.1 功能需求
- **数据处理流程**:
    1.  通过 `akshare` 库提供的东方财富数据源接口（如 `stock_balance_sheet_by_report_em` 等），获取全A股上市公司（不含北交所）的历史财务报表数据。
    2.  将获取的数据存储至本地数据库。
    3.  分析程序从该数据库读取数据进行计算和分析。
    4.  系统需支持定期（如按季度）从API更新增量数据到数据库。
- **目标公司输入**: 支持通过6位股票代码或公司中文名称指定待分析的公司。
- **分析时间范围**:
    - 分析近10年的数据。
    - 数据频率为季度。对于最近一个不完整的年度，使用TTM（Trailing Twelve Months）数据进行计算。
- **样本范围**: “全A股样本”指剔除北交所之外的所有沪深两市上市公司。不因行业（如金融）或状态（如ST）做额外剔除。
- **输出形式**:
    1.  **HTML报告**: 生成单个HTML文档，包含四大指标的图表（依次列出），所有文字使用中文显示。每个指标包含：目标公司历史走势、市场分位数历史走势、全市场中位数走势、当前分布情况。
    2.  **Excel文件**: 将所有计算的详细指标（如具体值、市场分位数等）导出为多工作表的Excel文件。

### 2.2 技术栈偏好
- 此部分将在后续的《技术调研报告》阶段进行详细讨论和确认。

### 2.3 数据规模
- **数据量**: 约5000家A股公司 * 10年 * 4份季度报告 ≈ 20万条记录。随着时间推移，数据量会持续增长。
- **并发量**: 设定为单用户本地运行，不考虑高并发场景。

### 2.4 性能要求
- **响应时间**: 作为一个离线分析工具，允许在秒级到分钟级的响应时间，无需实现实时计算。数据获取和首次入库过程耗时较长是可接受的。

### 2.5 质量标准
- **代码规范**: 遵循PEP 8等主流Python代码规范。
- **可维护性**: 代码结构应清晰、模块化，将数据获取、数据存储、指标计算、图表生成等功能解耦。

### 2.6 部署环境
- **部署**: 优先考虑作为本地应用程序在个人电脑（Windows/macOS/Linux）上运行。
- **依赖**: 运行环境需要能够访问互联网（用于API数据获取）和本地文件系统（用于数据库和结果存储）。

### 2.7 非功能需求
- **可扩展性**: 架构设计应便于未来新增或修改分析指标，以及更换数据源API。
- **数据一致性**: 需建立机制确保从API获取的数据在存入数据库时是完整和准确的。
- **用户体验**: 所有需要用户等待的操作都应显示进度条（如数据更新、中位数计算）。
- **数据质量监控**: 每次数据更新后自动生成数据质量报告，包含成功/失败统计、缺失字段统计、更新耗时等信息。
- **内存限制**: 程序应能在8GB内存的机器上稳定运行，单次加载数据不超过2GB。

## 3. 技术约束
- **数据源依赖**: 项目强依赖于 `akshare` 提供的东方财富数据接口。该接口的稳定性、数据质量和任何潜在的访问频率限制将直接影响本项目。
- **数据库需求**: 必须引入数据库（如SQLite、MySQL等）来管理数据，增加了项目的复杂性。

## 4. 非技术约束
- **数据合规性**: 使用API获取的数据可能受限于服务商的使用协议，需确保使用方式合规。
- **指标口径**: 不同数据源提供的财务报表科目名称和计算口径可能存在细微差异，需要在数据清洗阶段进行统一。
